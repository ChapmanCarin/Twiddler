<!DOCTYPE html>
<html>
  <head>
    <title>Twiddler</title>
    <link rel="stylesheet" href="css/site.css" type="text/css" />
    <script src="jquery.js"></script>
    <script src="data_generator.js"></script>
    <script src="https://unpkg.com/moment"></script>
    <style>

        .wrapper, html, body {
        height: 100%;
        margin: 0;
        }
        .wrapper {
        display: flex;
        flex-direction: column;
        }
        #navbar {
        border: solid cornflowerblue;
        }
        #main-content {
        flex:2;
        display: flex;
        }
        #all-tweets {
        border: 2px solid greenyellow;
        border-radius: 2px;
        flex: 1 1;
        }
        #selected-tweets {
        border: 2px solid greenyellow;
        border-radius: 2px;
        flex: 1 1;
        }
  </style>
  </head>
  <body> 

<div class="wrapper">
  <div id="navbar">
    <h1>Twiddler</h1>
    <button id="shawn">shawndrost</button>
    <button id="sharks">sharksforcheap</button>
    <button id="doug">douglascalhoun</button>
    <button id="notmarcus">mracus</button>
  </div>
  <div id="main-content">
    <div id="all-tweets"></div>
    <div id="selected-tweets"></div>
  </div>
</div>
  
    <script>

      $(document).ready(() => {
        const $body = $('body');
        const $allTweets = $('#all-tweets');
        // $body.html('');

        let index = streams.home.length - 1;
        while (index >= 0){
          const tweet = streams.home[index];
          const timeStamp = streams.home[index].created_at;

          const $tweet = $('<div class="tweet"></div>');
          $tweet.text('@' + tweet.user + ': ' + tweet.message + ' ' + moment(timeStamp).startOf('hour').fromNow());
          $tweet.appendTo($allTweets);
          index -= 1;
        }

        const tweetStream = function(){
          let index = streams.home.length - 1;
          while (index >= 0){
          const tweet = streams.home[index];
          const timeStamp = streams.home[index].created_at;

          const $tweet = $('<div class="tweet"></div>');
          $tweet.text('@' + tweet.user + ': ' + tweet.message + ' ' + moment(timeStamp).startOf('hour').fromNow());
          $tweet.appendTo($allTweets);
          index -= 1;
          }
        }

        const timer = setInterval(tweetStream, 7000);
        
        const $selectedTweets = $("#selected-tweets");

        const generateMessages = (user) => {
         return streams.users[user].map((userObj) => {
           let timeStamp = userObj.created_at;
            return ('@' + user + ': ' + userObj.message + ' ' + moment(timeStamp).startOf('hour').fromNow() + '\n');
          
          })
        }
        
            $("#shawn").on('click', (evt) => {
              $selectedTweets.html('');

              streams.users['shawndrost'].forEach($("#selected-tweets").append(generateMessages("shawndrost")));
            })
    
            $("#sharks").on('click', (evt) => {
            $selectedTweets.html('');
            streams.users['sharksforcheap'].forEach($("#selected-tweets").append(generateMessages("sharksforcheap")));
            })

            $("#doug").on('click', (evt) => {
            $selectedTweets.html('');
            streams.users['douglascalhoun'].forEach($("#selected-tweets").append(generateMessages("douglascalhoun")));
            })

            $("#notmarcus").on('click', (evt) => {
            $selectedTweets.html('');
            streams.users['mracus'].forEach($("#selected-tweets").append(generateMessages("mracus")));
            })

          
          //streams.users is an object with properties for each user. 
          //streams.users.shawndrost has all of shawndrostâ€˜s tweets.

        

        // clearInterval(timer);

      });
      </script>
  </body>
</html>
